<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lista de Ch√° de Panela</title>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc
    } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCjiUhEZQkAEaE-J9sjN3QJchbLIVdCot0",
      authDomain: "lista-de-casamento-b8939.firebaseapp.com",
      projectId: "lista-de-casamento-b8939",
      storageBucket: "lista-de-casamento-b8939.appspot.com",
      messagingSenderId: "665476991588",
      appId: "1:665476991588:web:4c6e99e2c6007ef0e2ad71"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const produtos = [
      "Conjunto de Panelas", "Jogo de Talheres", "Jogo de Pratos", "Jogo de Copos",
      "Frigideira Antiaderente", "Pirex", "Escorredor de Macarr√£o", "Assadeira",
      "Colheres de Silicone", "T√°buas de Corte", "Panela de Press√£o", "Forma de Bolo",
      "Ralador", "Abridor de Latas", "Espremedor de Alho", "Jarra de Suco", "Cesto de Roupa",
      "Varal", "Bacia para roupas", "Pregadores de roupa", "Baldes", "Toalhas de Banho",
      "Toalhas de Rosto", "Tapete de Banheiro", "Porta Sabonete", "Lixeira de Banheiro",
      "Jogo de Cama", "Travesseiros", "Cobertores", "Edredom", "Protetor de Colch√£o",
      "Jogo Americano", "Centro de Mesa", "Rel√≥gio de Parede", "Lixeira para Cozinha",
      "Porta-Temperos", "Panos de Prato", "Avental", "Potes de Pl√°stico"
    ];

    const lista = document.getElementById("lista-produtos");

    async function carregarProdutos() {
      const snapshot = await getDocs(collection(db, "presentes"));
      const enviados = new Set();
      snapshot.forEach(doc => enviados.add(doc.data().nome));

      produtos.forEach(nome => {
        if (!enviados.has(nome)) {
          const div = document.createElement("div");
          div.className = "produto";
          div.innerHTML = `<label><input type="checkbox" value="${nome}">${nome}</label>`;
          lista.appendChild(div);
        }
      });
    }

    window.mostrarResumo = () => {
      const selecionados = document.querySelectorAll('input[type="checkbox"]:checked');
      const listaResumo = document.getElementById("lista-resumo");
      listaResumo.innerHTML = "";
      selecionados.forEach(cb => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${cb.value}
          <button onclick="removerItem(this, '${cb.value}')">‚úñ</button>
        `;
        listaResumo.appendChild(li);
      });
      document.getElementById("resumo").style.display = "block";
    };

    window.removerItem = (botao, nome) => {
      botao.parentElement.remove();
      const checkbox = [...document.querySelectorAll('input[type="checkbox"]')].find(cb => cb.value === nome);
      if (checkbox) checkbox.checked = false;
    };

    window.limparResumo = () => {
      document.getElementById("lista-resumo").innerHTML = "";
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
    };

    window.enviarPedido = async () => {
      const nomePessoa = document.getElementById("nome-pessoa").value.trim();
      if (!nomePessoa) {
        alert("Por favor, insira seu nome.");
        return;
      }

      const numero = "5521975825319";
      const selecionados = [...document.querySelectorAll('input[type="checkbox"]:checked')];
      if (selecionados.length === 0) {
        alert("Selecione pelo menos um item.");
        return;
      }

      let mensagem = `Ol√°! Me chamo *${nomePessoa}* e gostaria de presentear com:\n`;

      for (const cb of selecionados) {
        mensagem += `- ${cb.value}\n`;
        await addDoc(collection(db, "presentes"), {
          nome: cb.value,
          enviado: true,
          por: nomePessoa,
          timestamp: Date.now()
        });
      }

      const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensagem)}`;
      window.open(url, "_blank");
      alert("Itens marcados como enviados com sucesso!");
      location.reload();
    };

    carregarProdutos();
  </script>

  <style>
    body {
      font-family: sans-serif;
      background: #f7f7f7;
      color: #333;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    .produto {
      background: #fff;
      border-radius: 10px;
      padding: 10px 15px;
      margin: 10px auto;
      max-width: 700px;
      display: flex;
      align-items: center;
    }

    .produto input {
      margin-right: 10px;
      transform: scale(1.3);
    }

    .btn {
      padding: 12px 20px;
      background: #2f8c4f;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px auto;
      display: block;
      max-width: 700px;
    }

    .btn:hover {
      background: #256b3e;
    }

    #resumo {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin: 30px auto;
      max-width: 700px;
      display: none;
    }

    #lista-resumo li {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid #ccc;
      padding: 10px 0;
    }

    #lista-resumo button {
      background: red;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
    }

    #campo-nome {
      margin-bottom: 15px;
    }

    #campo-nome input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <h1>üéÅ Lista de Presentes - Ch√° de Panela</h1>

  <div id="lista-produtos"></div>

  <button class="btn" onclick="mostrarResumo()">Revisar Itens Selecionados</button>

  <div id="resumo">
    <h2>üìù Itens Selecionados</h2>

    <div id="campo-nome">
      <input id="nome-pessoa" type="text" placeholder="Digite seu nome">
    </div>

    <ul id="lista-resumo"></ul>
    <button class="btn" onclick="limparResumo()">üßπ Limpar Tudo</button>
    <button class="btn" onclick="enviarPedido()">‚úÖ Enviar via WhatsApp</button>
  </div>

</body>
</html>
